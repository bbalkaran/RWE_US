library(kollect)
library(tidyverse)
library(kollekt)
connectNHWS()
searchNHWS(search = 'code', pattern = '^MG')
searchNHWS(search = 'code', pattern = list(pattern = '^MG'))
searchNHWS(search = 'code', pattern = list(pattern = 'MG'))
migraine_vars <- searchNHWS(search = 'code', pattern = list(pattern = 'MG'))
View(migraine_vars)
View(migraine_vars)
migraine_query <-genNHWSquery("US",years = 2017,vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"))
MG <- runNHWSquery(migraine_query)
View(MG)
migraine_query <-genNHWSquery("US",years = c(2017),vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"))
MG <- runNHWSquery(migraine_query)
migraine_query <-genNHWSquery("US",years = "2017",vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"))
MG <- runNHWSquery(migraine_query)
migraine_query <-genNHWSquery("US", year = "2017",vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"))
MG <- runNHWSquery(migraine_query)
migraine_query <-genNHWSquery(region = "US", years =  2017,vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"))
MG <- runNHWSquery(migraine_query)
migraine_query <-genNHWSquery(region = "US", years =  2017,vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"))
MG <- runNHWSquery(migraine_query)
migraine_query <-genNHWSquery(region = "US", years =  2017,vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"), cci = T, demog = T)
MG <- runNHWSquery(migraine_query)
genNHWSquery
runNHWSquery
View(migraine_query)
migraine_query[["query_char"]]
migraine_query[["query_num"]][[1]]
MG <- MG %>% filter(source == "us_2017")
MG <- runNHWSquery(migraine_query)
View(MG)
MG <- MG %>% filter(source == "us_2017")
MG <- getIndex(MG)
MG <- runNHWSquery(migraine_query)
MG <- getIndex(MG)
MG <- MG %>% filter(source == "us_2017")
library(foreign)
dat <- read.spss("./Analysis/Data/Lilly migraine data 0v1 05-October-2018(LABELLED)10112018_new.sav", to.data.frame = T)
connectNHWS()
migraine_query <-genNHWSquery(region = "US", years =2017,vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"), cci = T, demog = T)
MG <- runNHWSquery(migraine_query)
library(kollekt)
library(tidyverse)
# 2. get NHWS data -----
connectNHWS()
migraine_query <-genNHWSquery(region = "US", years =2017,vars = c("MGAUR","MGMSP", "MGNAU", "MGTHR",
"MGASY", "MGMOV", "MGLS", "MGSND",
"MGSPT", "MGHRS", "MGNO", "MGHDDX",
"MGDXY", "MGDXDR", "MGFQ1M", "MGFQ6MO",
"MGTPHD", "MGTPHDDK", "MHCHR", "MGMSW",
"MGMSH", "MGHDX", "MGHIT1", "MGHIT2",
"MGHIT3", "MGHIT4", "MGHIT5", "MGHIT6",
"MGRX%", "MGTP%", "MGDY", "MGSA%", "MGDR%",
"MGPR", "MGRE", "MGW%", "MGRXEVR", "MGDRRC",
"MGMC"), cci = T, demog = T)
MG <- runNHWSquery(migraine_query)
MG <- getIndex(MG)
selectNHWSdf
selectNHWSdf
# 1. workspace -----
library(tidyverse)
library(xlsx)
library(data.table)
# 1. workspace -----
library(tidyverse)
library(readxl)
library(readr)
X109_Enrollment_File <- read_csv("C:/Users/balkaranb/OneDrive - Kantar/Projects/Lilly Migraine Prevention Phase II/Data/Raw/Closed_Claims/109_Enrollment_File.csv")
View(X109_Enrollment_File)
Enrollment_File <- read_csv("./Data/Raw/Closed_Claims/109_Enrollment_File.csv")
Enrollment_File <- read_csv("../Data/Raw/Closed_Claims/109_Enrollment_File.csv")
library(readr)
Mx_Header <- read_csv("C:/Users/balkaranb/OneDrive - Kantar/Projects/Lilly Migraine Prevention Phase II/Data/Raw/Closed_Claims/109_Medical_Claims_Header.csv")
View(Mx_Header)
Mx_Header <- read_csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Header.csv")
Mx_Service_Lines <- read_csv("..Data/Raw/Closed_Claims/109_Medical_Claims_Service_Lines.csv")
Mx_Service_Lines <- read_csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Service_Lines.csv")
problems(...)
problems(Mx_Service_Lines)
Rx_Claims <- read_csv("../Data/Raw/Closed_Claims/109_Pharmacy_Claims.csv")
Enrollment_File %>% filter(has_closed_medical_benefit == T & has_closed_pharmacy_benefit == T)
ClosedClaims <- Enrollment_File %>% filter(has_closed_medical_benefit == T & has_closed_pharmacy_benefit == T)
ClosedClaims %>% left_join(Mx_Header)
ClosedClaims <- ClosedClaims %>% left_join(Mx_Header)
ClosedClaims %>% left_join(Mx_Service_Lines)
`109_Medical_Claims_Header` <- read.csv("C:/Users/balkaranb/OneDrive - Kantar/Projects/Lilly Migraine Prevention Phase II/Data/Raw/Closed_Claims/109_Medical_Claims_Header.csv", stringsAsFactors=FALSE)
View(`109_Medical_Claims_Header`)
Mx_Header <- read.csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Header.csv")
Mx_Service_Lines <- read.csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Service_Lines.csv")
Rx_Claims <- read.csv("../Data/Raw/Closed_Claims/109_Pharmacy_Claims.csv")
options(scipen = 999)
Mx_Header$admission_date %>% as.Date('%Y-%m-%d')
View(Mx_Header)
library(magrittr)
Mx_Header$admission_date %<>% as.Date('%Y-%m-%d')
Mx_Header$discharge_date %>% as.Date('%Y-%m-%d')
Mx_Header$discharge_date %<>% as.Date('%Y-%m-%d')
Mx_Header$claim_date %>% as.Date('%Y-%m-%d')
Mx_Header$claim_date %>% as.Date('%Y-%m-%d')
Mx_Header$claim_date %<>% as.Date('%Y-%m-%d')
Mx_Header$file_date %>% as.Date('%Y-%m-%d')
Mx_Header$file_date %<>% as.Date('%Y-%m-%d')
Mx_Header$patient_dob %>% as.Date('%Y-%m-%d')
Mx_Header <- read.csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Header.csv", stringsAsFactors = F)
Mx_Header$admission_date %<>% as.Date('%Y-%m-%d')
Mx_Header$discharge_date %<>% as.Date('%Y-%m-%d')
Mx_Header$claim_date %<>% as.Date('%Y-%m-%d')
Mx_Header$file_date %<>% as.Date('%Y-%m-%d')
Mx_Header$patient_dob %>% as.Date('%Y-%m-%d')
Mx_Header$patient_dob %<>% as.Date('%Y-%m-%d')
Mx_Header$received_date %>% as.Date('%Y-%m-%d')
Mx_Header$received_date %<>% as.Date('%Y-%m-%d')
Mx_Service_Lines <- read.csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Service_Lines.csv", stringsAsFactors = F)
Rx_Claims <- read.csv("../Data/Raw/Closed_Claims/109_Pharmacy_Claims.csv", stringsAsFactors = F)
Mx_Service_Lines$service_to %>% as.Date('%m/%d/%Y')
Mx_Service_Lines$service_to %<>% as.Date('%m/%d/%Y')
Mx_Service_Lines$service_from %<>%  as.Date('%m/%d/%Y')
Mx_Service_Lines$file_date %<>%  as.Date('%m/%d/%Y')
Mx_Service_Lines$date_of_service %<>%  as.Date('%m/%d/%Y')
Mx_Service_Lines$received_date %<>%  as.Date('%m/%d/%Y')
Rx_Claims$patient_dob %>%  as.Date('%m/%d/%Y')
Rx_Claims$patient_dob %<>%  as.Date('%m/%d/%Y')
Rx_Claims$date_of_service %<>%  as.Date('%m/%d/%Y')
Rx_Claims$extract_date %<>%  as.Date('%m/%d/%Y')
Rx_Claims$date_authorized %<>%  as.Date('%m/%d/%Y')
Rx_Claims$received_date %<>%  as.Date('%m/%d/%Y')
ClosedClaims <- Enrollment_File %>% filter(has_closed_medical_benefit == T & has_closed_pharmacy_benefit == T)
Enrollment_File <- read_csv("../Data/Raw/Closed_Claims/109_Enrollment_File.csv")
ClosedClaims <- Enrollment_File %>% filter(has_closed_medical_benefit == T & has_closed_pharmacy_benefit == T)
ClosedClaims %>% left_join(Mx_Header)
ClosedClaims <- ClosedClaims %>% left_join(Mx_Header)
ClosedClaims %>% left_join(Mx_Service_Lines)
ClosedClaims <- ClosedClaims %>% left_join(Mx_Service_Lines)
M.ClosedClaims <- ClosedClaims %>% left_join(Mx_Service_Lines)
Enrollment_File <- read_csv("../Data/Raw/Closed_Claims/109_Enrollment_File.csv")
Mx_Header <- read.csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Header.csv", stringsAsFactors = F)
Mx_Service_Lines <- read.csv("../Data/Raw/Closed_Claims/109_Medical_Claims_Service_Lines.csv", stringsAsFactors = F)
Rx_Claims <- read.csv("../Data/Raw/Closed_Claims/109_Pharmacy_Claims.csv", stringsAsFactors = F)
Mx_Header$admission_date %<>% as.Date('%Y-%m-%d')
Mx_Header$discharge_date %<>% as.Date('%Y-%m-%d')
Mx_Header$claim_date %<>% as.Date('%Y-%m-%d')
Mx_Header$file_date %<>% as.Date('%Y-%m-%d')
Mx_Header$patient_dob %<>% as.Date('%Y-%m-%d')
Mx_Header$received_date %<>% as.Date('%Y-%m-%d')
Mx_Service_Lines$service_to %<>% as.Date('%m/%d/%Y')
Mx_Service_Lines$service_from %<>%  as.Date('%m/%d/%Y')
Mx_Service_Lines$file_date %<>%  as.Date('%m/%d/%Y')
Mx_Service_Lines$date_of_service %<>%  as.Date('%m/%d/%Y')
Mx_Service_Lines$received_date %<>%  as.Date('%m/%d/%Y')
Rx_Claims$patient_dob %<>%  as.Date('%m/%d/%Y')
Rx_Claims$date_of_service %<>%  as.Date('%m/%d/%Y')
Rx_Claims$extract_date %<>%  as.Date('%m/%d/%Y')
Rx_Claims$date_authorized %<>%  as.Date('%m/%d/%Y')
Rx_Claims$received_date %<>%  as.Date('%m/%d/%Y')
ClosedClaims <- Enrollment_File %>% filter(has_closed_medical_benefit == T & has_closed_pharmacy_benefit == T)
ClosedClaims <- ClosedClaims %>% left_join(Mx_Header)
M.ClosedClaims <- ClosedClaims %>% left_join(Mx_Service_Lines)
save(M.ClosedClaims, file = "../Data/Claims/Medical_Claims.csv")
save(M.ClosedClaims, file = "../Data/Claims/Medical_Claims.RData")
library(tidyverse)
library(xlsx)
library(data.table)
load("../Data/Claims/Medical_Claims.RData")
Dir <- list.files("C:/Users/balkaranb/OneDrive - Kantar/Projects/OHDSI_Vocabularies/")
paths<- lapply(Dir, function(x){paste("C:/Users/balkaranb/OneDrive - Kantar/Projects/OHDSI_Vocabularies/", x, sep = "")})
paths[[10]] <- NULL
OHDSI <- lapply(paths, fread)
OHDSI <- OHDSI[[1]]
Migraine_ICD_text <- grep("migraine", OHDSI$concept_name, value = T, ignore.case = T)
Migraine_ICD_text
grep("status migrainous", OHDSI$concept_name, value = T, ignore.case = T)
grep("status migrainosus", OHDSI$concept_name, value = T, ignore.case = T)
grep("cerebral infarction", OHDSI$concept_name, value = T, ignore.case = T)
grep("aura", OHDSI$concept_name, value = T, ignore.case = T)
grep("with aura", OHDSI$concept_name, value = T, ignore.case = T)
grep("migraine seizure", OHDSI$concept_name, value = T, ignore.case = T)
grep("migraine $seizure", OHDSI$concept_name, value = T, ignore.case = T)
grep("depression", OHDSI$concept_name, value = T, ignore.case = T)
grep("bipolar", OHDSI$concept_name, value = T, ignore.case = T)
grep("depressive", OHDSI$concept_name, value = T, ignore.case = T)
grep("panic", OHDSI$concept_name, value = T, ignore.case = T)
grep(" panic ", OHDSI$concept_name, value = T, ignore.case = T)
grep(" panic ", OHDSI$concept_name, value = T, ignore.case = T)
grep(" panic | Panic", OHDSI$concept_name, value = T, ignore.case = T)
grep(" panic"|"Panic", OHDSI$concept_name, value = T, ignore.case = T)
grep(" panic|Panic ", OHDSI$concept_name, value = T, ignore.case = T)
grep(" panic |Panic ", OHDSI$concept_name, value = T, ignore.case = T)
grep(" panic |^Panic ", OHDSI$concept_name, value = T, ignore.case = T)
grep("vertigo", OHDSI$concept_name, value = T, ignore.case = T)
grep("insomnia", OHDSI$concept_name, value = T, ignore.case = T)
grep("serotonin", OHDSI$concept_name, value = T, ignore.case = T)
grep("serotonin syndrome", OHDSI$concept_name, value = T, ignore.case = T)
grep("T50.995A", OHDSI$concept_code, value = T, ignore.case = T)
grep("ulcer", OHDSI$concept_name, value = T, ignore.case = T)
grep("gastric ulcer", OHDSI$concept_name, value = T, ignore.case = T)
grep("R10.9$",OHDSI$concept_code, value = T, ignore.case = T)
Migraine_complications_text <- list(grep("status migrainosus", OHDSI$concept_name, value = T, ignore.case = T),
grep("cerebral infarction", OHDSI$concept_name, value = T, ignore.case = T),
grep("with aura", OHDSI$concept_name, value = T, ignore.case = T),
grep("depressive", OHDSI$concept_name, value = T, ignore.case = T),
grep("bipolar", OHDSI$concept_name, value = T, ignore.case = T),
grep(" panic |^Panic ", OHDSI$concept_name, value = T, ignore.case = T),
grep("vertigo", OHDSI$concept_name, value = T, ignore.case = T),
grep("insomnia", OHDSI$concept_name, value = T, ignore.case = T),
grep("serotonin syndrome", OHDSI$concept_name, value = T, ignore.case = T),
grep("gastric ulcer", OHDSI$concept_name, value = T, ignore.case = T),
grep("serotonin syndrome", OHDSI$concept_name, value = T, ignore.case = T))
Migraine_complcations_ICD <- list(
grep("T50.995A", OHDSI$concept_code, value = T, ignore.case = T),
grep("R10.9$",OHDSI$concept_code, value = T, ignore.case = T),
grep("T39.395A ",OHDSI$concept_code, value = T, ignore.case = T))
Migraine_OHDSI <- OHDSI %>% filter(concept_name %in% unlist(Migraine_complications_text))
Migraine_OHDSI_2 <- OHDSI %>% filter(concept_code %in% unlist(Migraine_complcations_ICD))
grep("T39.395A ",OHDSI$concept_code, value = T, ignore.case = T)
grep("T39.39$ ",OHDSI$concept_code, value = T, ignore.case = T)
grep("T39.3$ ",OHDSI$concept_code, value = T, ignore.case = T)
Migraine_complications <- Migraine_OHDSI %>% full_join(Migraine_OHDSI_2) %>%
as_tibble() %>% distinct()
Migraine_complications <- Migraine_complications %>% select(-standard_concept, -valid_start_date, -valid_end_date, -invalid_reason)%>% arrange(concept_name)
write.xlsx(Migraine_complications, file = "../Data/Potential_Migraine_Complications_ICDcodes.xlsx")
Migraine_complications$concept_name %>% n_distinct()
